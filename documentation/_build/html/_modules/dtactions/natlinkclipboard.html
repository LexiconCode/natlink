

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>natlink.natlinkclipboard &mdash; natlink 1.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> natlink
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project.html">Project</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">natlink</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>natlink.natlinkclipboard</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for natlink.natlinkclipboard</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># This file was part of Dragonfly.</span>
<span class="c1"># (c) Copyright 2007, 2008 by Christo Butcher</span>
<span class="c1"># Licensed under the LGPL.</span>
<span class="c1">#</span>
<span class="c1"># It is now improved and augmented for the Natlink project</span>
<span class="c1"># by Quintijn Hoogenboom for wider use 15/7/2019, ..., March 2021</span>
<span class="c1"># See also unittestClipboard.py in Unimacro/unimacro_test</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This file implements an interface to the Windows system clipboard.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">win32clipboard</span>
<span class="kn">import</span> <span class="nn">win32con</span>

<span class="c1">#===========================================================================</span>

<div class="viewcode-block" id="Clipboard"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard">[docs]</a><span class="k">class</span> <span class="nc">Clipboard</span><span class="p">:</span>

    <span class="c1">#-----------------------------------------------------------------------</span>

    <span class="n">format_text</span>      <span class="o">=</span> <span class="n">win32con</span><span class="o">.</span><span class="n">CF_TEXT</span>
    <span class="n">format_oemtext</span>   <span class="o">=</span> <span class="n">win32con</span><span class="o">.</span><span class="n">CF_OEMTEXT</span>
    <span class="n">format_unicode</span>   <span class="o">=</span> <span class="n">win32con</span><span class="o">.</span><span class="n">CF_UNICODETEXT</span>
    <span class="n">format_locale</span>    <span class="o">=</span> <span class="n">win32con</span><span class="o">.</span><span class="n">CF_LOCALE</span>
    <span class="n">format_hdrop</span>     <span class="o">=</span> <span class="n">win32con</span><span class="o">.</span><span class="n">CF_HDROP</span>
    <span class="n">format_names</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">format_text</span><span class="p">:</span>     <span class="s2">&quot;text&quot;</span><span class="p">,</span>
                    <span class="n">format_oemtext</span><span class="p">:</span>  <span class="s2">&quot;oemtext&quot;</span><span class="p">,</span>
                    <span class="n">format_unicode</span><span class="p">:</span>  <span class="s2">&quot;unicode&quot;</span><span class="p">,</span>
                    <span class="n">format_locale</span><span class="p">:</span>   <span class="s2">&quot;locale&quot;</span><span class="p">,</span>
                    <span class="n">format_hdrop</span><span class="p">:</span>    <span class="s2">&quot;hdrop&quot;</span><span class="p">,</span>
                   <span class="p">}</span>

<div class="viewcode-block" id="Clipboard.get_system_text"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.get_system_text">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_system_text</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get text from the clipboard</span>
<span class="sd">        </span>
<span class="sd">        from natlinkclipboard import Clipboard</span>
<span class="sd">        </span>
<span class="sd">        simply call: text = Clipboard.get_system_text()</span>
<span class="sd">        </span>
<span class="sd">        as alias also Get_text can be used, so: text = Clipboard.Get_text()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">OpenClipboardCautious</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard, get_system_text: could not open clipboard&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_unicode</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_text</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_oemtext</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">GetClipboardData</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">content</span><span class="p">:</span> <span class="k">break</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard, get_system_text, no content found&#39;</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">content</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">content</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">content</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">win32clipboard</span><span class="o">.</span><span class="n">CloseClipboard</span><span class="p">()</span></div>

    <span class="n">Get_text</span> <span class="o">=</span> <span class="n">get_system_text</span>

<div class="viewcode-block" id="Clipboard.set_system_text"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.set_system_text">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_system_text</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set text to the clipboard</span>
<span class="sd">        </span>
<span class="sd">        First the clipboard is emptied. </span>
<span class="sd">        </span>
<span class="sd">        This method fails when not in elevated mode.</span>
<span class="sd">        </span>
<span class="sd">        As alias, you can also call: Clipboard.Set_text(&quot;abacadabra&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;set to clipboard: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span> <span class="n">content</span><span class="p">)</span>
        <span class="c1"># content = str(content)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">OpenClipboardCautious</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard, set_system_text: could not open clipboard&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">clipNum</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">GetClipboardSequenceNumber</span><span class="p">()</span>
        <span class="c1"># print &#39;clipboard number: %s&#39;% clipNum</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">win32clipboard</span><span class="o">.</span><span class="n">EmptyClipboard</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bytes</span><span class="p">:</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_text</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_unicode</span>
            
            <span class="n">win32clipboard</span><span class="o">.</span><span class="n">SetClipboardData</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard, cannot set text to clipboard: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span> <span class="n">content</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">clipNum2</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">GetClipboardSequenceNumber</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">clipNum2</span> <span class="o">==</span> <span class="n">clipNum</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard, did not increment clipboard number: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span> <span class="n">clipNum</span><span class="p">)</span>
            <span class="n">win32clipboard</span><span class="o">.</span><span class="n">CloseClipboard</span><span class="p">()</span></div>
    <span class="n">Set_text</span> <span class="o">=</span> <span class="n">set_system_text</span>

<div class="viewcode-block" id="Clipboard.Get_clipboard_formats"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.Get_clipboard_formats">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Get_clipboard_formats</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns a list of format types of current clipboard</span>
<span class="sd">        </span>
<span class="sd">        This is mainly meant for debugging purposes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">OpenClipboardCautious</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;get_clipboard_formats, could not open clipboard&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># </span>
            <span class="n">formats</span> <span class="o">=</span> <span class="n">_get_clipboard_formats_open_clipboard</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">formats</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">win32clipboard</span><span class="o">.</span><span class="n">CloseClipboard</span><span class="p">()</span></div>

<div class="viewcode-block" id="Clipboard.get_system_folderinfo"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.get_system_folderinfo">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_system_folderinfo</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">waiting_time</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns a tuple of file/folder info of selected files or folders</span>
<span class="sd">        </span>
<span class="sd">        As alias use Get_folderinfo, Get_hdrop or get_system_hdrop</span>
<span class="sd">        </span>
<span class="sd">        win32con.CF_HDROP is the parameter for calling this type of clipboard data</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">OpenClipboardCautious</span><span class="p">(</span><span class="n">waiting_time</span><span class="o">=</span><span class="n">waiting_time</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard, get_system_folderinfo, could not open clipboard&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">folderinfo</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">GetClipboardData</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">format_hdrop</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>                    
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> folderinfo: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">folderinfo</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="n">folderinfo</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;got it!&#39;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">folderinfo</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard, get_system_folderinfo: no folder info found.&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">return</span> <span class="n">folderinfo</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">win32clipboard</span><span class="o">.</span><span class="n">CloseClipboard</span><span class="p">()</span></div>
    
    <span class="n">get_system_hdrop</span> <span class="o">=</span> <span class="n">get_system_folderinfo</span>
    <span class="n">Get_folderinfo</span> <span class="o">=</span> <span class="n">get_system_folderinfo</span>
    <span class="n">Get_hdrop</span> <span class="o">=</span> <span class="n">get_system_folderinfo</span>

    <span class="c1">#-----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_system</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;initialisation of clipboard instance.</span>
<span class="sd">        </span>
<span class="sd">        save_clear can be set to True, current clipboard contents is saved and cleared</span>
<span class="sd">               saved contents are kept in self._backup and will be retrieved</span>
<span class="sd">               when instance is destroyed.</span>
<span class="sd">        from_system: obsolete option</span>
<span class="sd">        contents: can be set as initial contents of the clipboard (not tested, 2019)</span>
<span class="sd">        text: can be set as initial text contents of the clipboard (not tested, 2019)</span>
<span class="sd">        debug: default off, 1: important messages are printed, &gt; 1 more messages are printed</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backup</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">OpenClipboardCautious</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning Clipboard: at initialisation could not open the clipboard&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_sequence_number</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">GetClipboardSequenceNumber</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current_sequence_number: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_sequence_number</span><span class="p">)</span>

        <span class="c1"># If requested, retrieve current system clipboard contents.</span>
        <span class="k">if</span> <span class="n">from_system</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy_from_system</span><span class="p">(</span><span class="n">save_clear</span><span class="o">=</span><span class="n">save_clear</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">save_clear</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy_from_system</span><span class="p">(</span><span class="n">save_clear</span><span class="o">=</span><span class="n">save_clear</span><span class="p">)</span>

        <span class="c1"># Process given contents for this Clipboard instance.</span>
        <span class="k">if</span> <span class="n">contents</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Clipboard: Invalid contents: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">contents</span><span class="p">))</span>

        <span class="c1"># Handle special case of text content.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">format_unicode</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;restore clipboard if self._backup contains data</span>
<span class="sd">        </span>
<span class="sd">        This is so if save_clear is True when the instance was created,</span>
<span class="sd">        and when the clipboard held data at that moment.</span>
<span class="sd">        </span>
<span class="sd">        Note: need elevated mode for setting the clipboard...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backup</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">skip</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span><span class="p">:</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;(empty)&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
                    <span class="n">shorter</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; // &#39;</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
                    <span class="n">arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">shorter</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
                    
                <span class="n">skip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_text</span><span class="p">)</span>
                <span class="n">skip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_unicode</span><span class="p">)</span>
                <span class="n">skip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_oemtext</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(no_text)&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contents</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">format</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_names</span><span class="p">:</span>
                    <span class="n">arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_names</span><span class="p">[</span><span class="nb">format</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="nb">format</span><span class="p">))</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>

<div class="viewcode-block" id="Clipboard.copy_from_system"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.copy_from_system">[docs]</a>    <span class="k">def</span> <span class="nf">copy_from_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_clear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">waiting_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">waiting_iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy the Windows system clipboard contents into this instance.</span>

<span class="sd">            Arguments:</span>
<span class="sd">             - *formats* (iterable, default: None) -- if not None, only the</span>
<span class="sd">               given content formats will be retrieved.  If None, all</span>
<span class="sd">               available formats will be retrieved.</span>
<span class="sd">             - *save_clear* (boolean, default: False) -- if true, the Windows</span>
<span class="sd">               system clipboard will be saved in self._backup, and</span>
<span class="sd">               cleared after its contents have been retrieved.</span>
<span class="sd">               Will be restored from self._backup when the instance is destroyed.</span>
<span class="sd">               If false contents are retrieved in self._contents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">waiting_interval</span> <span class="ow">or</span> <span class="n">waiting_iterations</span><span class="p">:</span>
            <span class="n">waiting_interval</span> <span class="o">=</span> <span class="n">waiting_interval</span> <span class="ow">or</span> <span class="mf">0.025</span>
            <span class="n">waiting_iterations</span> <span class="o">=</span> <span class="n">waiting_iterations</span> <span class="ow">or</span> <span class="mi">10</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_clipboard_change</span><span class="p">(</span><span class="n">waiting_interval</span><span class="p">,</span> <span class="n">waiting_iterations</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no clipboard change&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="n">waiting_iterations</span><span class="o">*</span><span class="mf">0.7</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;did have to wait </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s1"> steps of </span><span class="si">{</span><span class="n">waiting_iterations</span><span class="si">}</span><span class="s1"> with interval of </span><span class="si">{</span><span class="n">waiting_interval</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> seconds.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">OpenClipboardCautious</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard copy_from_system, could not open clipboard&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>                
        <span class="c1"># Determine which formats to retrieve.</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_clipboard_data_from_system</span><span class="p">(</span><span class="n">formats</span><span class="o">=</span><span class="n">formats</span><span class="p">)</span>

            <span class="c1"># Retrieve Windows system clipboard content.</span>
            <span class="k">if</span> <span class="n">save_clear</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">contents</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_backup</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard, set backup to: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backup</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_backup</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">win32clipboard</span><span class="o">.</span><span class="n">EmptyClipboard</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">contents</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">contents</span>
        <span class="k">finally</span><span class="p">:</span>    
            <span class="c1"># Clear the system clipboard, if requested, and close it.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_sequence_number</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">GetClipboardSequenceNumber</span><span class="p">()</span>
            <span class="n">win32clipboard</span><span class="o">.</span><span class="n">CloseClipboard</span><span class="p">()</span>
            <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">_get_clipboard_data_from_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;once the clipboard is opened, just get the clipboard data</span>
<span class="sd">        </span>
<span class="sd">        meant as internal functions, called from copy_from_system</span>
<span class="sd">        return the contents as a dict, see for example method get_text</span>
<span class="sd">        also leave the contents in self._contents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">formats</span><span class="p">:</span>
            <span class="n">formats</span> <span class="o">=</span> <span class="n">_get_clipboard_formats_open_clipboard</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">formats</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">formats</span> <span class="o">=</span> <span class="p">(</span><span class="n">formats</span><span class="p">,)</span>

        <span class="c1"># Verify that the given formats are valid.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">formats</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;_get_clipboard_data_from_system, no formats available, empty clipboard...&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">contents</span>

        <span class="k">if</span> <span class="n">formats</span><span class="p">:</span>
            <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">formats</span><span class="p">:</span>
                <span class="c1"># if not format in self.format_names.keys():</span>
                <span class="c1">#     # print &#39;not getting clipboard for format: %s&#39;% format</span>
                <span class="c1">#     continue</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">GetClipboardData</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
                    <span class="n">contents</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># unknown formats, which cannot be handled</span>
                    <span class="c1"># # print(&quot;_get_clipboard_data_from_system, format %s (%s) not available&quot;% (format, self.format_names[format]))</span>
                    <span class="c1"># actual_formats = _get_clipboard_formats_open_clipboard()</span>
                    <span class="c1"># if actual_formats:</span>
                    <span class="c1">#     print(&#39;_get_clipboard_data_from_system, formats asked for not available: %s, available are: %s&#39;% (formats, actual_formats))</span>
                    <span class="c1"># else:</span>
                    <span class="c1">#     print(&#39;_get_clipboard_data_from_system, clipboard empty&#39;)</span>
                    <span class="c1"># return {}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span> <span class="o">=</span> <span class="n">contents</span>
            <span class="k">return</span> <span class="n">contents</span>

<div class="viewcode-block" id="Clipboard.copy_to_system"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.copy_to_system">[docs]</a>    <span class="k">def</span> <span class="nf">copy_to_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy the contents of this instance to the Windows clipboard</span>

<span class="sd">            Arguments:</span>
<span class="sd">            - data: text or dict of clipboard items (format, content) pairs</span>
<span class="sd">             - *clear* (boolean, default: True) -- if true, the Windows</span>
<span class="sd">               system clipboard will be cleared before this instance&#39;s</span>
<span class="sd">               contents are transferred.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">OpenClipboardCautious</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;copy_to_system, could not open clipboard&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Clear the system clipboard, if requested.</span>
            <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">win32clipboard</span><span class="o">.</span><span class="n">EmptyClipboard</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard, cannot EmptyClipboard, need more rights, can also not restore backup of clipboard&#39;</span><span class="p">)</span>
    
            <span class="c1"># Transfer content to Windows system clipboard.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">for</span> <span class="nb">format</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="n">win32clipboard</span><span class="o">.</span><span class="n">SetClipboardData</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clipboard, copy_to_system, invalid type of data: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">========&quot;</span><span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                <span class="k">return</span> 
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_sequence_number</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">GetClipboardSequenceNumber</span><span class="p">()</span>
            <span class="n">win32clipboard</span><span class="o">.</span><span class="n">CloseClipboard</span><span class="p">()</span></div>

<div class="viewcode-block" id="Clipboard.Set_text_and_paste"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.Set_text_and_paste">[docs]</a>    <span class="k">def</span> <span class="nf">Set_text_and_paste</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;a one shot function to past text back into the application</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">t</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy_to_system</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
            <span class="k">pass</span></div>
        <span class="c1">#### to be finished</span>


<div class="viewcode-block" id="Clipboard.restore"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.restore">[docs]</a>    <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;restore the _backup to the system clipboard</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backup</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy_to_system</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backup</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard restore, nothing to restore&#39;</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="Clipboard.clear_clipboard"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.clear_clipboard">[docs]</a>    <span class="k">def</span> <span class="nf">clear_clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Empty the clipboard and clear the internal clipboard data</span>
<span class="sd">        </span>
<span class="sd">        assume the clipboard is open</span>
<span class="sd">        </span>
<span class="sd">        this will be done at init phase with save_clear == True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;clear_clipboard, before start, sequence number: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_sequence_number</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">OpenClipboardCautious</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;copy_to_system, could not open clipboard&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>        
            <span class="n">win32clipboard</span><span class="o">.</span><span class="n">EmptyClipboard</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;clipboard, clear_clipboard, could not clear the clipboard&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_sequence_number</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">GetClipboardSequenceNumber</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;clear_clipboard, new sequence number: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_sequence_number</span><span class="p">)</span>
            <span class="n">win32clipboard</span><span class="o">.</span><span class="n">CloseClipboard</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Clipboard.has_format"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.has_format">[docs]</a>    <span class="k">def</span> <span class="nf">has_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine whether this instance has content for the given format</span>

<span class="sd">            Arguments:</span>
<span class="sd">             - *format* (int) -- the clipboard format to look for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">format</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span><span class="p">)</span></div>

<div class="viewcode-block" id="Clipboard.get_format"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.get_format">[docs]</a>    <span class="k">def</span> <span class="nf">get_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieved this instance&#39;s content for the given *format*.</span>

<span class="sd">            Arguments:</span>
<span class="sd">             - *format* (int) -- the clipboard format to retrieve.</span>

<span class="sd">            If the given *format* is not available, a *ValueError*</span>
<span class="sd">            is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Clipboard format not available: </span><span class="si">%r</span><span class="s2">&quot;</span>
                             <span class="o">%</span> <span class="nb">format</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">set_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>

<div class="viewcode-block" id="Clipboard.has_text"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.has_text">[docs]</a>    <span class="k">def</span> <span class="nf">has_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">waiting_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">waiting_iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Determine whether this instance has text content. &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_unicode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span>
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Clipboard.get_text"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.get_text">[docs]</a>    <span class="k">def</span> <span class="nf">get_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">waiting_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">waiting_iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replaceNullChar</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get the text (mostly unicode) contents of the clipboard</span>
<span class="sd">        </span>
<span class="sd">        This method first does a copy from system.</span>
<span class="sd">        </span>
<span class="sd">        If no text content available, return &quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_from_system</span><span class="p">(</span><span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">format_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_text</span><span class="p">],</span> <span class="n">waiting_interval</span><span class="o">=</span><span class="n">waiting_interval</span><span class="p">,</span> <span class="n">waiting_iterations</span><span class="o">=</span><span class="n">waiting_iterations</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">contents</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_unicode</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">format_unicode</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">replaceNullChar</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_text</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">format_text</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get contents, but no expected format: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span> <span class="n">contents</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span></div>

    <span class="k">def</span> <span class="nf">set_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">format_unicode</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="n">text</span>    <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
                       <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span>    <span class="bp">self</span><span class="o">.</span><span class="n">get_text</span><span class="p">(),</span>
                       <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                      <span class="p">)</span>

<div class="viewcode-block" id="Clipboard.get_folderinfo"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.get_folderinfo">[docs]</a>    <span class="k">def</span> <span class="nf">get_folderinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">waiting_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">waiting_iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve this instance&#39;s folderinfo (also hdrop)</span>
<span class="sd">        </span>
<span class="sd">        do a copy_from_system automatically</span>
<span class="sd">           </span>
<span class="sd">        This should be a tuple of valid paths. The paths are not checked.</span>

<span class="sd">        If no valid info, return None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy_from_system</span><span class="p">(</span><span class="n">waiting_interval</span><span class="o">=</span><span class="n">waiting_interval</span><span class="p">,</span> <span class="n">waiting_iterations</span><span class="o">=</span><span class="n">waiting_iterations</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_hdrop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">format_hdrop</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Clipboard.save_sequence_number"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.Clipboard.save_sequence_number">[docs]</a>    <span class="k">def</span> <span class="nf">save_sequence_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get the Clipboard Sequence Number and store in instance</span>
<span class="sd">        </span>
<span class="sd">        It is set in self.current_sequence_number, no return</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_sequence_number</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">GetClipboardSequenceNumber</span><span class="p">()</span></div>
        
    <span class="k">def</span> <span class="nf">_wait_for_clipboard_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">waiting_time</span><span class="p">,</span> <span class="n">waiting_iterations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;wait a few steps until the clipboard is not changed.</span>
<span class="sd">        </span>
<span class="sd">        The previous Clipboard Sequence Number should be in</span>
<span class="sd">        the instance variable self.current_sequence_number</span>
<span class="sd">        </span>
<span class="sd">        This value is set when opening the clipboard, or in this internal function.</span>
<span class="sd">        </span>
<span class="sd">        When in doubt, call _set_sequence_number, before doing a copy!</span>
<span class="sd">        </span>
<span class="sd">        return True if changed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">w_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">waiting_time</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">w_time</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="k">if</span> <span class="n">w_time</span> <span class="o">&gt;</span> <span class="mf">0.55</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard, _wait_for_clipboard_change, waiting time too long, set to 0.1&#39;</span><span class="o">%</span> <span class="n">w_time</span><span class="p">)</span>
            <span class="n">w_time</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">n_wait</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">waiting_iterations</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">n_wait</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">n_wait</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n_wait</span> <span class="o">=</span> <span class="mi">4</span>
            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_wait</span><span class="p">):</span>
            <span class="n">new_sequence_number</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">GetClipboardSequenceNumber</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">new_sequence_number</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_sequence_number</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_sequence_number</span> <span class="o">=</span> <span class="n">new_sequence_number</span>
                <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---Clipboard changed after </span><span class="si">%s</span><span class="s1"> steps of </span><span class="si">%.4f</span><span class="s1">s (</span><span class="si">%.4f</span><span class="s1">)&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">w_time</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">w_time</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;_wait_for_clipboard_change, clipboard changed immediately&#39;</span><span class="p">)</span>
                <span class="c1"># time.sleep(w_time)</span>
                <span class="k">return</span> <span class="n">i</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">w_time</span><span class="p">)</span>
        <span class="c1"># no result:</span>
        <span class="n">time_waited</span> <span class="o">=</span> <span class="n">n_wait</span><span class="o">*</span><span class="n">w_time</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clipboard, no change in clipboard in </span><span class="si">%.4f</span><span class="s1"> seconds&#39;</span><span class="o">%</span> <span class="n">time_waited</span><span class="p">)</span>


    
    <span class="n">get_hdrop</span> <span class="o">=</span> <span class="n">get_folderinfo</span></div>

<span class="k">def</span> <span class="nf">_get_clipboard_formats_open_clipboard</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;return clipboard formats available, when clipboard is open</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">formats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">EnumClipboardFormats</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">formats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">win32clipboard</span><span class="o">.</span><span class="n">EnumClipboardFormats</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">formats</span>

<div class="viewcode-block" id="OpenClipboardCautious"><a class="viewcode-back" href="../../natlinkclipboard.html#natlink.natlinkclipboard.OpenClipboardCautious">[docs]</a><span class="k">def</span> <span class="nf">OpenClipboardCautious</span><span class="p">(</span><span class="n">nToTry</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">waiting_time</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;sometimes, wait a little before you can open the clipboard...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nToTry</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">win32clipboard</span><span class="o">.</span><span class="n">OpenClipboard</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">waiting_time</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># wait = (i+2)*waiting_time</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;had to wait, and extra wait </span><span class="si">%s</span><span class="s1"> OpenClipboardCautious: </span><span class="si">%s</span><span class="s1"> seconds&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">wait</span><span class="p">))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">waiting_time</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span></div>
    
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Quintijn Hoogenboom.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>